var request = require('request');
var self = module.exports;

self.searchItems = function(options, callback) {
	request("http://api.remix.bestbuy.com/v1/products(name="+options+"*)?show=name,salePrice,url,thumbnailImage,manufacturer&format=json&apiKey=npm62r3juru55gsxuggxyzbj", function (error, response, body) {
		
		if (!error && response.statusCode == 200) {
			
			try{
				//console.log("Searching for: "+options);
				var result = {};
				var list = JSON.parse(body);
				list = list.products;	
				list.sort( predicatBy("salePrice") );
				result = list[0];
				result.store = "bestbuy";
			//	console.log("searching for cheapest item........");
			//	console.log(result);
			if (callback) callback(null, result);
		}catch(err){
			console.log("BestBuy item non trouve !!!!!!!" +err);
		}
	}
	else {
		if (callback) callback(new Error("Error getting search"), null);
	}
});
};

function predicatBy(prop){
	return function(a,b){
		if( a[prop] > b[prop]){
			return 1;
		}else if( a[prop] < b[prop] ){
			return -1;
		}
		return 0;
	}
}
