var request = require('request');
//var S = require('string');
var aws = require("aws-lib");
var fs = require("fs");
prodAdv = aws.createProdAdvClient("AKIAI43V7ZBTTCPVKXGA", "2IR0LjNM9I77lLWe4U9BPPnC2k8hq+oK7ULNGGj2", "p07957-20");
var self = module.exports;

self.searchItems = function(params, callback) {

	prodAdv.call("ItemSearch", {SearchIndex: params.category, Keywords: params.keywords}, function(err, result) {
    if (err){
     if (callback) callback(new Error("Error getting search"), null);
   }

   try{

    fs.writeFile("logs/result.txt", JSON.stringify(result, null, 4));
  		//console.log("Resultat"+JSON.stringify(result, null, 4));

      console.log("first item in da list at AMAZON:  "+result.Items.Item[0].ItemAttributes.Title);
      var resultClean = {};
      resultClean.salePrice = 9.99;
      resultClean.store = "amazon";
      resultClean.manufacturer = result.Items.Item[0].ItemAttributes.Manufacturer;
      resultClean.name = result.Items.Item[0].ItemAttributes.Title;
      resultClean.thumbnailImage = "none";
      resultClean.url = result.Items.Item[0].ItemLinks.ItemLink[0].URL;
      console.log(JSON.stringify(resultClean));
      result = resultClean;
    }catch(err){
      console.log("Amazon item non trouve !!!!!!!" +err);
    }
    if (callback) callback(null, result);
  });
};
function predicatBy(prop){
 return function(a,b){
  if( a[prop] > b[prop]){
    return 1;
  }else if( a[prop] < b[prop] ){
    return -1;
  }
  return 0;
}
}
